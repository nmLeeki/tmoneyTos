<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" href="assets/css/tos.css" />
    <title>티머니 이용안내 - 완료</title>
</head>
<body class="tos_body">
<div class="t_container">
  <div class="t_box type2">
      <div class="t_body">
         <div class="t_finish">
             <div class="t_img_box">
                 <img src="./assets/images/ic_check_main.png" alt="체크 아이콘" />
             </div>
             <p class="t_title">
                 <b>모바일 어르신교통카드</b>
                 발급 안내 사항 확인 완료
             </p>
             <p class="t_subTitle">
                 모바일 어르신교통카드 발급을 위한<br />
                 안내 사항 확인이 완료되었습니다.
             </p>
         </div>
      </div>
  </div>
   <div class="t_num_wrap">
      <span>주민등록번호</span>
      <div class="t_num_box">
          <div class="t_input_box">
              <div class="t_input front">
                  <input type="text" placeholder="●●●●●●" maxlength="6" inputmode="numeric" id="num_01" name="num_01" title="주민등록번호 앞자리" />
              </div>
              <span>-</span>
              <div class="t_input t_input_mask">
                  <input class="secure" type="text" placeholder="●●●●●●●" maxlength="7" inputmode="numeric" id="num_02" name="num_02" title="주민등록번호 뒷자리" />
              </div>
          </div>
          <button type="button" class="t_input_btn">확인</button>
      </div>
   </div>
    <div class="t_footer">
        <button class="t_submit_btn">발급하기</button>
    </div>
</div>



<script>
    // 주민등록번호 입력 및 마스킹 처리 스크립트
    (function () {
        // DOM 요소 캐싱
        const i1 = document.getElementById('num_01'); // 앞자리 input
        const i2 = document.getElementById('num_02'); // 뒷자리 input
        const maskBox2 = i2.closest('.t_input_mask'); // 뒷자리 마스킹 박스
        const btn = document.querySelector('.t_input_btn'); // 확인 버튼
        const submitBtn = document.querySelector('.t_submit_btn'); // 발급 버튼

        /**
         * 숫자만 추출
         * @description 입력값에서 숫자만 남김
         */
        const onlyNum = (v) => v.replace(/\D/g, '');

        /**
         * 버튼 활성화/비활성화 처리
         * @description 입력값이 모두 채워지면 버튼 활성화
         */
        function updateBtn() {
            const full = i1.value.length === 6 && i2.value.length === 7;
            btn.disabled = !full;
            btn.classList.toggle('active', full);
        }

        /**
         * 뒷자리 마스킹 처리
         * @description 뒷자리는 항상 동그라미로 마스킹
         */
        function updateMask2() {
            const len = i2.value.length;
            maskBox2.setAttribute('data-mask', len === 0 ? '' : '●'.repeat(len));
        }

        /**
         * 앞자리 입력 이벤트
         * @description 숫자만 입력, 6자리 제한
         */
        function onInput1(e) {
            let val = onlyNum(e.target.value).slice(0, 6);
            e.target.value = val;
            updateBtn();
            if (val.length === 6) {
                i2.focus();
                handleFocus(i2, 240);
                console.log('asd')
            }
        }

        /**
         * 뒷자리 입력 이벤트
         * @description 숫자만 입력, 7자리 제한, 입력 시 마스킹 갱신
         */
        function onInput2(e) {
            let val = onlyNum(e.target.value).slice(0, 7);
            e.target.value = val;
            updateBtn();
            updateMask2();
        }

        /**
         * 뒷자리에서 백스페이스 시 앞자리로 이동
         * @description 뒷자리 값이 없을 때 백스페이스 누르면 앞자리로 포커스 이동
         */
        function onKeydown2(e) {
            if (e.key === 'Backspace' && i2.value.length === 0) {
                i1.focus();
                handleFocus(i1, 240);
                const len = i1.value.length;
                i1.setSelectionRange(len, len);
            }
        }

        /**
         * 붙여넣기 이벤트
         * @description 붙여넣기 시 자동으로 앞/뒷자리 분리 입력
         */
        function onPaste(e) {
            const text = (e.clipboardData || window.clipboardData).getData('text');
            const digits = onlyNum(text);
            if (digits.length >= 7) {
                e.preventDefault();
                i1.value = digits.slice(0, 6);
                i2.value = digits.slice(6, 13);
                i2.focus();
                updateBtn();
                updateMask2();
            }
        }

        /**
         * input 포커스 시 스크롤 버그 방지
         * @description 모바일에서 input 포커스 시 스크롤 튐 방지
         */
        function attachInputScroll(inputEl) {
            if (!inputEl) return () => {};
            const handleScroll = (e) => {
                const ae = document.activeElement;
                if (ae === inputEl || (inputEl.contains && inputEl.contains(e.target))) {
                    if (ae && typeof ae.blur === 'function') ae.blur();
                }
            };
            window.addEventListener('touchmove', handleScroll, { passive: true });
            return () => window.removeEventListener('touchmove', handleScroll);
        }

        /**
         * input 포커스 시 스크롤 위치 조정 (ios 버그 대응)
         * @description 포커스된 input을 화면 중앙 근처로 이동
         */
        function handleFocus(inputEl, num) {
            setTimeout(() => {
                const rect = inputEl.getBoundingClientRect();
                const targetY = rect.top - 240 + num;
                window.scrollTo({ top: targetY, behavior: 'smooth' });
            }, 1);
        }

        // 이벤트 바인딩
        i1.addEventListener('input', onInput1);
        i2.addEventListener('input', onInput2);
        i2.addEventListener('keydown', onKeydown2);
        i1.addEventListener('paste', onPaste);
        i2.addEventListener('paste', onPaste);
        i1.addEventListener('focus', () => handleFocus(i1, 0));
        i2.addEventListener('focus', () => handleFocus(i2, 0));

        // 모바일 스크롤 버그 방지 적용
        const detach1 = attachInputScroll(i1);
        const detach2 = attachInputScroll(i2);

        // 초기 상태 세팅
        updateBtn();
        updateMask2();
        // 페이지 언로드 시 이벤트 제거
        window.addEventListener('beforeunload', () => {
            detach1();
            detach2();
        });

        /**
         * 확인 버튼 클릭 이벤트
         * @description 입력값이 모두 채워지면 발급 버튼 활성화
         */
        btn.addEventListener('click', function () {
            if (btn.disabled) return;
            console.log('주민등록번호:', i1.value + '-' + i2.value);
            submitBtn.classList.add('active');
        });

        /**
         * 발급 버튼 클릭 이벤트
         * @description 활성화 상태에서만 alert 출력
         */
        submitBtn.addEventListener('click', function (e) {
            if (!submitBtn.classList.contains('active')) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            } else {
                alert('샘플 예시입니다. 주민등록번호: ' + i1.value + '-' + i2.value);
            }
        });
    })();
</script>
</body>
</html>
